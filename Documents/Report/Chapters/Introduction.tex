% Introduction to Master Thesis

\section{Background}


At a library, bad work distribution among staff can cause problems and result in a shortage of staff at certain critical shifts. If a worker becomes unavailable at such a shift, due to for example illness, a qualified stand in is required to fill the vacancy. Therefore, it is of high priority to libraries and other similar institutions to create schedules with as many skilled stand ins as possible in order to handle such unexpected disturbances. 

The problem addressed in this thesis work concerns the library staff at the Central Library of Norrköping. The library has around 40 employees and the renown building from the 1950's is a central gathering point in Norrköping. The library is open weekdays from eight to eight and from eleven to four during weekends. The generous opening times also creates a scheduling challenge for the library as it requires a large pool of well coordinated personnel to keep the library open. In addition, the library also provides its services to one other smaller library, which adds further complexity to the problem of task distribution among staff.

\section{Problem description}

The problem studied involves creating a ten week task distribution for all workers with a high number of stand ins at all days. We were given the workers' individual availability schedules, the staffing demand at different tasks, shifts, days and weeks and the constraints and demands discussed in this section. 

\subsection{Description of the daily tasks at the library} \label{section:library_tasks}
The highest priority at a library, as with any service institution, is the provision of good service to visitors. This includes providing book loan services as well as being able to give visitors helpful information about the resources at disposal at the library. This type of work is referred to as "outer tasks" in this thesis. In addition to these, "inner tasks" such as sorting books, ordering new books and answering emails also exist and are equally a part of the every day library tasks. In this thesis, the problem of allocating the outer tasks, while taking inner tasks into consideration, is studied.

Three main outer task types can be identified at the library of Norrköping; working at the service counter (sv. expiditionsdisken), working at the information counter (sv. informationsdiken) and assembling books which are to be sent to other libraries according to the "fetch list" (sv. plocklista). The fetch list is a task type for which the worker is scheduled during a whole day, while the other types of tasks are scheduled for only one shift. The outer tasks can be performed by either librarians or both librarians and assistants, as described in Table \ref{tab:Outer_Tasks}.

\begin{table}[h]
\centering
\caption{Outer tasks can be performed exclusively by librarians or by both librarians and assistants.}
\label{tab:Outer_Tasks}
\begin{tabularx}{\textwidth}{|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Task} & \textbf{Description} & \textbf{Qualification}\\ \hline 
%------------------------------------------------------------------- 
\specialcell[t]{Service counter \\ (Exp)}  & \specialcell[t]{Administring loans, library cards\\ and the loaning machine} & \specialcell[t]{Librarian or \\  assistant} 
%\begin{tabular}[x]{@{}c@{}}\\\end{tabular}  
\\ \hline
%-------------------------------------------------------------------
\specialcell[t]{Information counter \\ (Info)} & \specialcell[t]{Handling questions \\about the library's resources.} & Librarian
\\ \hline 
%-------------------------------------------------------------------
\specialcell[t]{Fetch list \\(PL)} & \specialcell[t]{Fetching books that are to be \\sent to other libraries.} & \specialcell[t]{Librarian  or \\  assistant}
\\ \hline 
%-------------------------------------------------------------------
\specialcell[t]{Hageby \\(HB)} & \specialcell[t]{Handling librarian tasks at the filial \\ Hageby during weekends.} & Librarian
\\ \hline 
%-------------------------------------------------------------------
\specialcell[t]{Library on Wheels \\(BokB)} & \specialcell[t]{Driving the Library on Wheels \\ to different areas of town.} & Librarian
\\ \hline 
%-------------------------------------------------------------------
\end{tabularx}
\end{table} 

\begin{table}[ht]
\centering
\caption{Worker demand during a week. PL is marked as one shift, but is performed during a whole day.}
\label{tab:Outer_Task_Demand}
\begin{tabular}{|C{1.2cm}
|C{1cm}|C{1cm}|C{1cm}|C{1cm}|}
\hline
\rowcolor{Gray} & Exp & Info & PL & HB  \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Monday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Tuesday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Wednesday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0 \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0 \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Thursday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Friday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Saturday } \\ \hline
\colcell Shift 1: & 3 & 3 & 0 & 1  \\ \hline
\multicolumn{5}{|l|}{\colcelltwo Sunday } \\ \hline
\colcell Shift 1: & 3 & 3 & 0 & 1  \\ \hline
 \end{tabular}
\end{table}

As in the case with most libraries, the Central Library of Norrköping also has responsibilities that fall outside of its normal daily activities. One such responsibility is weekend staffing a smaller library subsidiary in Hageby, situated in the suburban area of Norrköping. It is decided that only librarians are qualified for this task. While some librarians prefer to work only at HB, others prefer never working at HB. 

Working during a weekend implies working both Saturday and Sunday. When not working at HB, the Friday evening shift is also part of the weekend work. The weekend work is compensated with free days, often placed at the week following upon weekend work.


Since the number of visitors at the library varies throughout the day and also during different days of the week, so does the demand for personnel for the outer tasks tasks. This demand is illustrated in Table \ref{tab:Outer_Task_Demand}, which is constructed according to figures given by the library. 

Another library task is the "Library on Wheels" (sv. bokbussen), for which only a handful of librarians are qualified. The work involves driving a library bus which provides citizens in remoter areas of the city with books as well as other library services. The Library on Wheels only operates a few times a week and the schedule differs between odd and even weeks in accordance with Table \ref{tab:LOW_Demand}.

\begin{table}[ht]
\centering
\caption{Demand of staff Library on Wheels}
\label{tab:LOW_Demand}
\begin{tabularx}{0.80\textwidth}{|l|X|X|X|X|X|}
\hline
%%-------------------------------------------------------------------
 \textbf{Odd Week} & \textbf{Mon} & \textbf{Tue} & \textbf{Wed} & \textbf{Thu} & \textbf{Fri} 
 \\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
08:00-10:00 & 1 & 0 & 1 & 1 & 1 
\\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
16:00-20:00 & 1 & 0 & 1 & 1 & 0 
\\ \hline 
%%-------------------------------------------------------------------
 \textbf{Even Week} & \textbf{Mon} & \textbf{Tue} & \textbf{Wed} & \textbf{Thu} & \textbf{Fri} 
 \\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
08:00-10:00 & 1 & 0 & 1 & 1 & 0 
\\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
16:00-20:00 & 0 & 0 & 1 & 1 & 0 
\\ \hline 
\end{tabularx}
\end{table}

Apart from the outer work described above, there is also inner work at the library which sometimes need to be scheduled. One such type of inner work is meetings, as it concerns a large number of staff. There exists both library meetings, scheduled for the whole work force, and department meetings, scheduled only a subset of workers. The library meetings are fixed in time and take place every fifth weeks on Monday mornings 8:15-10:00 while the department meetings are more flexible and take place every fifth week. For department meetings, all department members must be available. Only three departments have scheduled meetings: the child department, the adult department and the media department.

\subsection{Personnel attributes}

The two types of library workers that are to be assigned tasks in this thesis are librarians and assistants. Librarian can perform all the tasks listed in the previous section, while assistants can perform a subset of these tasks.

The Central Library of Norrköping currently has 39 library workers, 23 of which are librarians and 16 of which are assistants. Both worker types have different availabilities for performing tasks, depending on their working hours and the amount of inner work they have. In the standard case, each worker is assigned one evening per week and once per five weeks he/she is assigned to work during the weekend. The week after is normally compensated with two extra free days, placed according to the wishes of the worker.

Let us consider a sample worker who is a librarian, works full time and is also assigned to evening work on Wednesdays. The worker is also assigned to work weekend on the fourth week and has chosen to take out its days off on Thursdays and Fridays during the following week. The availability for such a worker is illustrated in table \ref{tab:Bob_avail}. The schedule repeats itself after five weeks and illustrates only the availability for outer tasks, not whether the worker has been assigned any tasks or not.

All workers have a five week schedule in the same manner as the sample worker. However, in order to meet the weekend demands illustrated by Tables \ref{tab:Outer_Task_Demand} for all ten weeks, workers have to be assigned for weekend work at different weekends. Thus, a worker's schedule can be shifted in order to make sure that all weekends demand is fulfilled.

\begin{table}[!h]
\centering
\caption{Availability schedule for a sample worker. Yellow signifies that the worker is available. In parenthesis, the weekend shift.}
\label{tab:Bob_avail}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 1}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 2}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 3}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 4}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}

\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 5}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & & & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & & & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\end{table} 

Considering again the sample worker's schedule in Table \ref{tab:Bob_avail}, the worker is avaialble throughout all days. However, four basic constraints regulate how tasks can be placed during availability. Firstly, workers are only allowed to take at a maximum one task per day. This guarantees that workers also have time for inner tasks. Secondly, workers are only allowed to perform a maximum of four tasks per week, in order for them to have a completely free day. Thirdly, workers can only be assigned to PL at a most once a week. The restriction for ten weeks varies between different workers, but should never exceed four. Lastly, a worker should not have the same shift more than twice a week. This guarantees that there is fairness in the schedule so that no worker has to work too many times at a shift considered "bad". An example of a feasible weekly schedule for the sample worker is provided in Table \ref{tab:Lib_feas_sched}.

 Availability for all workers is provided by the library. Some workers work differently even and odd weeks while other never work evenings, only work weekends or never work weekends. This data was used in order to solve the problem.

\begin{table}[!h]
\centering
\caption{Example of a feasible week for a worker.}
\label{tab:Lib_feas_sched}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 1} & \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\small \colcell 08:00-10:00 (11:00-16:00)& \colcelltwo & \small \colcellthree Exp & \colcelltwo & \small \colcellthree PL & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\small \colcell 10:00-13:00 & \small \colcellthree Exp & \colcelltwo & \colcelltwo & \small \colcellthree PL & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\small \colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \small \colcellthree PL & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\small \colcell 16:00-20:00 & & & \small \colcellthree Info& & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\end{table} 


\subsection{Scheduling objectives: stand-in maximization and schedule variation}

When we first were presented with the scheduling task, it was explained to us that the main challenge for the library is to find a good number stand ins for all days. When we studied their schedule, we observed that only one stand in was present at the worst day. Thus, the main objective of this thesis work is to create a feasible schedule, according to the constraints explained in this section, with as many stand ins as possible at the day with the least number of stand ins.

In this context, a stand in is defined by the as a worker who is available for outer tasks during the first three shifts, and who is not scheduled for any shift that day. Both librarians and assistants can be scheduled as a stand-in, but only librarians are qualified to take an Info task. Since the regular hour library activity are most crucial, there is no need for stand ins during evenings and weekends. Similarly, there are no assigned stand ins for the Library on Wheels or for Hageby.

Apart from maximizing the number of stand-ins for each day at the library, it is desirable for the sake of the personnel to create schedules in which are repeated according to a five week pattern. Thus, the ten week schedule should ideally become two five week schedules. 

\section{Method}
The method for solving the problem described above is to create a mathematical model for the problem, which will be solved using two different methods. The first method involves modeling the probelm in the AMPL programming language and solving it in the commercial optimization solver CPLEX. The second method involves creating an independent solver in C++ and solving it using a heuristic. 

Two different heuristics were to be tested. The first heuristic distributes week blocks to workers. All blocks are pregenerated and feasible accordign to the constraints described in the previous section. In the second heuristic, individual tasks are distributed to the workers. In order to find better solutions and moving through the solution space, both heuristics were to be based on a large neighbourhood search (LNS) algorithm.

\section{Disposition of the report}

The report is divided into the following chapters:

\begin{itemize}
	\item Chapter \ref{chap:intro}: background to the problem is given.
	\item Chapter \ref{chap:lit}: previous work in the area of scheduling is described.
	\item Chapter \ref{chap:mathmod}: the problem is formulated as a mathematical model.
	\item Chapter \ref{chap:impl}: the different implementations of the problem are compared.
	\item Chapter \ref{chap:weekly}: the implementation of the weekly scheduling approach is presented.
	\item Chapter \ref{chap:taskdist}: the implementation of the task distribution approach is presented.
	\item Chapter \ref{chap:res}: the results for the implementations are presented and discussed.
	\item Chapter Further Development
	\item Chapter Conclusion
\end{itemize}











\iffalse



\begin{table}[h]
\centering
\caption{Overall schedule for week 1.}
\label{tab:General_schedule}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Schedule week 1} & & & & &  
\\ \hline 
%%------------------------------------------------------------------- 
\textbf{Monday}& \colcell \textbf{Exp} & \colcell \textbf{Info} & \colcell \textbf{PL} & \colcell \textbf{LoW - odd} & \colcell \textbf{LoW- even} 
\\ \hline 
%%------------------------------------------------------------------- 

 08:00 - 10:00 & \small W1, W2 & \small W1,W2 & \small W1 & \small W1 & \small W1
\\ \hline 
%%------------------------------------------------------------------- 
 10:00 - 13:00 & \small W1, W2, W3 & \small W1, W2, W3 & \small W1 & - & -
\\ \hline 
%%------------------------------------------------------------------- 
 13:00 - 16:00 & \small W1, W2, W3 & \small W1, W2, W3 & \small W1 & - & -
\\ \hline 
%%------------------------------------------------------------------- 
 16:00 - 20:00 & \small W1, W2, W3 & \small W1, W2, W3 & \small W1 & - & -
\\ \hline 
%%------------------------------------------------------------------- 
\textbf{Tuesday}& \colcell \textbf{Exp} & \colcell \textbf{Info} & \colcell \textbf{PL} & \colcell \textbf{LoW - odd } & \colcell \textbf{LoW- even} 
\\ \hline 
%%------------------------------------------------------------------- 
\textbf{Wednesday}& \colcell \textbf{Exp} & \colcell \textbf{Info} & \colcell \textbf{PL} & \colcell \textbf{LoW - odd } & \colcell \textbf{LoW- even} 
\\ \hline 
%%-------------------------------------------------------------------
\textbf{Thursday}& \colcell \textbf{Exp} & \colcell \textbf{Info} & \colcell \textbf{PL} & \colcell \textbf{LoW - odd } & \colcell \textbf{LoW- even} 
\\ \hline 
%%-------------------------------------------------------------------
\textbf{Friday}& \colcell \textbf{Exp} & \colcell \textbf{Info} & \colcell \textbf{PL} & \colcell \textbf{LoW - odd } & \colcell \textbf{LoW- even} 
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\end{table}

\fi
