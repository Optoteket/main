% Introduction to Master Thesis

At a library, there exist a number of tasks which are to be distributed over all staff members. Poor work distribution among staff can cause problems and result in a shortage of staff at certain critical shifts. If a worker becomes unavailable at such shifts, due to for example illness, a qualified stand-in is required to fill the vacancy. Therefore, it is of high priority to libraries and other similar institutions to create schedules with as many skilled stand-ins as possible in order to handle such unexpected disturbances. 

The problem addressed in this thesis work concerns the library staff at the Central Library of Norrköping, Sweden. This library currently has 39 employees and the renown building from the 1950's is a central gathering point in Norrköping. The library is open weekdays from 8 a.m. to 8 p.m. and from 11 a.m. to 16 p.m. during weekends. The generous opening times also creates a scheduling challenge for the library as it requires a large pool of well coordinated personnel to keep the library open. In addition, the library also provides its services to one other smaller library, which adds further complexity to the problem of task distribution among the staff.

This chapter contains a problem description, where the scheduling problem at hand is described in detail, a section describing the goals and aims of the thesis work, a section about the methods used to solve the problem and an outline of this report.

\section{Problem description}

The main objective of the problem studied is to create a ten week schedule for all staff members and tasks at the library. Each staff member's ten week schedule should consist of two five-week schedules which should be as similar as possible, but not identical since some tasks are performed only even or odd weeks. The ten week schedule should be rotational.

The schedule should also be created so that the stand-ins are distributed evenly over all days. In order to do this, the library provided information about when staff members are available for task assignment, what tasks should be assigned when as well as the constraints for how these tasks should be assigned. These constraints are discussed in detail in this section.

\subsection{Description of the daily tasks at the library} \label{section:library_tasks}
The highest priority at a library, as with any service institution, is to provide good service to visitors. This includes book loan services as well as being able to give visitors helpful information about the resources at disposal at the library. This type of work is referred to as "outer tasks" in this thesis. In addition to these, "inner tasks" such as sorting books, ordering new books and answering emails also exist and are a part of the every day library tasks as well. The problem of allocating the outer tasks, while taking inner tasks into consideration, is studied in this thesis.

Three main types of outer task can be identified at the library of Norrköping: working at the service counter (sv. expidetionsdisken), working at the information counter (sv. informationsdisken) and assembling books which are to be sent to other libraries according to the "fetch list" (sv. plocklista). The fetch list is a task for which the worker is scheduled during a whole day, while the other tasks are scheduled for only one shift. The outer tasks can be performed by either librarians or both librarians and assistants, as described in Table \ref{tab:Outer_Tasks}.

\begin{table}[h]
\centering
\caption{Outer tasks can be performed either exclusively by librarians or by both librarians and assistants.}
\label{tab:Outer_Tasks}
\begin{tabularx}{\textwidth}{|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Task} & \textbf{Description} & \textbf{Qualification}\\ \hline 
%------------------------------------------------------------------- 
\specialcell[t]{Service counter \\ (Exp)}  & \specialcell[t]{Administring loans, library cards\\ and the loaning machine} & \specialcell[t]{Librarian or \\  assistant} 
%\begin{tabular}[x]{@{}c@{}}\\\end{tabular}  
\\ \hline
%-------------------------------------------------------------------
\specialcell[t]{Information counter \\ (Info)} & \specialcell[t]{Handling questions \\about the library's resources.} & Librarian
\\ \hline 
%-------------------------------------------------------------------
\specialcell[t]{Fetch list \\(PL)} & \specialcell[t]{Fetching books that are to be \\sent to other libraries.} & \specialcell[t]{Librarian  or \\  assistant}
\\ \hline 
%-------------------------------------------------------------------
\specialcell[t]{Hageby \\(HB)} & \specialcell[t]{Handling librarian tasks at the filial \\ Hageby during weekends.} & Librarian
\\ \hline 
%-------------------------------------------------------------------
\specialcell[t]{Library on Wheels \\(BokB)} & \specialcell[t]{Driving the Library on Wheels \\ to different areas of town.} & Librarian
\\ \hline 
%-------------------------------------------------------------------
\end{tabularx}
\end{table} 

\begin{table}[ht]
\centering
\caption{Staff demand during a week. PL is marked as one shift, but it is performed during the whole day.}
\label{tab:Outer_Task_Demand}
\begin{tabular}{|C{1.2cm}
|C{1cm}|C{1cm}|C{1cm}|C{1cm}|}
\hline
\rowcolor{Gray} & Exp & Info & PL & HB  \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Monday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Tuesday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Wednesday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0 \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0 \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Thursday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Friday } \\ \hline
\colcell Shift 1: & 2 & 2 & 1 & 0  \\ \hline
\colcell Shift 2: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 3: & 3 & 3 & 0 & 0  \\ \hline
\colcell Shift 4: & 3 & 3 & 0 & 0  \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Saturday } \\ \hline
\colcell Shift 1: & 3 & 3 & 0 & 1  \\ \hline
\multicolumn{5}{|l|}{\cellcolor{gray!90} Sunday } \\ \hline
\colcell Shift 1: & 3 & 3 & 0 & 1  \\ \hline
 \end{tabular}
\end{table}

As in the case with most libraries, the Central Library of Norrköping also has responsibilities that fall outside of its normal daily activities. One such responsibility is staffing a smaller library subsidiary in Hageby, situated in the suburban area of Norrköping, during weekends. It is decided that only librarians are qualified for this task. While some librarians prefer to work only at HB, others prefer never to.

Working during a weekend means working both Saturday and Sunday. When not working at HB, the Friday evening shift is also part of the weekend work. The weekend work is compensated with free days, often placed at the week following upon weekend work, in this thesis referred to as rest week.


Since the number of visitors at the library varies throughout the day and also during different days of the week, so does the demand for personnel for the outer tasks. This demand is illustrated in Table \ref{tab:Outer_Task_Demand}, which is constructed according to figures given by the library. 

Another library task is the "Library on Wheels" (sv. bokbussen), for which only a handful of librarians are qualified. This work involves driving a library bus, which provides citizens in remoter areas of the city with books as well as other library services. The Library on Wheels only operates a few times a week and the schedule differs between odd and even weeks in accordance with Table \ref{tab:LOW_Demand}.

\begin{table}[ht]
\centering
\caption{Demand of staff for Library on Wheels}
\label{tab:LOW_Demand}
\begin{tabularx}{0.80\textwidth}{|l|X|X|X|X|X|}
\hline
%%-------------------------------------------------------------------
 \textbf{Odd Week} & \textbf{Mon} & \textbf{Tue} & \textbf{Wed} & \textbf{Thu} & \textbf{Fri} 
 \\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
08:00-10:00 & 1 & 0 & 1 & 1 & 1 
\\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
16:00-20:00 & 1 & 0 & 1 & 1 & 0 
\\ \hline 
%%-------------------------------------------------------------------
 \textbf{Even Week} & \textbf{Mon} & \textbf{Tue} & \textbf{Wed} & \textbf{Thu} & \textbf{Fri} 
 \\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
08:00-10:00 & 1 & 0 & 1 & 1 & 0 
\\ \hline 
%%------------------------------------------------------------------- 
\rowcolor{Gray} 
16:00-20:00 & 0 & 0 & 1 & 1 & 0 
\\ \hline 
\end{tabularx}
\end{table}

Apart from the outer tasks described above, there are also inner tasks at the library which sometimes need to be scheduled. One such type of inner task is meetings, which concerns a large number of staff members. There exist both library meetings, scheduled for the whole work force, and group meetings, scheduled only for a subset of the staff members. The library meetings are fixed in time and take place every fifth weeks on Monday mornings from 8:15 a.m. to 10:00 a.m. Also group meetings take place every fifth week but are flexible in time. For group meetings, all group members must be available. Only three groups have scheduled meetings: the child, adult and media group.

\subsection{Personnel attributes}

The two types of library workers that are to be assigned tasks are librarians and assistants. Librarians can perform all the tasks listed above, while assistants can perform a subset of these tasks.

The Central Library of Norrköping currently has 39 library staff members, 23 of which are librarians and 16 of which are assistants. These have different availabilities for performing tasks, depending on their working hours and the amount of inner work they have. In the standard case, each worker is assigned one evening per week and once per five weeks he or she is assigned to work during the weekend. This is normally compensated the week after with two extra free days, placed according to the wishes of the worker.

Let us consider a sample staff member who is a librarian, works full time and is also assigned to evening work on Wednesdays. The worker is also assigned to work weekend on the fourth week and has chosen to take out its days off on Thursday and Friday during the week following the weekend. The availability for such a worker is illustrated in Table \ref{tab:Bob_avail}. The schedule repeats itself after five weeks and illustrates only the availability for outer tasks. It does not show whether the worker has been assigned any tasks or not.

All staff members have a five week schedule in the same manner as the sample worker. However, in order to meet the weekend demands, illustrated in Table \ref{tab:Outer_Task_Demand}, staff members have to be assigned for weekend work at different weekends. Thus, a staff memeber's schedule can be shifted in order to make sure that all weekend demands are fulfilled.

\begin{table}[!h]
\centering
\caption{Availability schedule for a sample worker. Yellow signifies that the worker is available. In parenthesis, the weekend shift.}
\label{tab:Bob_avail}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 1}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 2}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 3}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 4}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo &   & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}

\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 5}& \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\colcell 08:00-10:00 (11:00-16:00) & \colcelltwo & \colcelltwo & \colcelltwo & & & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 10:00-13:00 & \colcelltwo & \colcelltwo & \colcelltwo & & & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\colcell 16:00-20:00 & & & \colcelltwo & & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\end{table} 

Considering again the sample staff member's schedule in Table \ref{tab:Bob_avail}, where the person is available throughout all days, five basic constraints regulate how tasks can be placed. Firstly, workers are only allowed to take at a maximum one task per day. This guarantees that workers also have time for inner tasks. Secondly, workers are only allowed to perform a maximum of four tasks per week, in order for them to have a completely free day. Thirdly, workers can only be assigned to PL at a most once a week.
Also, there is a maximum limit of PL tasks in total over all ten weeks which varies between different staff members, but which is at the most four. Lastly, a worker should not have the same shift more than twice a week. This guarantees that there is fairness in the schedule so that no worker has to work too many times at a shift which is considered to be "bad". An example of a feasible weekly schedule for the sample worker is provided in Table \ref{tab:Lib_feas_sched}.

 The availability of all workers is provided by the library. Some workers work differently even and odd weeks while other never work evenings, only work weekends or never work weekends. This data was used in order to solve the scheduling problem.

\begin{table}[!h]
\centering
\caption{Example of a feasible week for a worker.}
\label{tab:Lib_feas_sched}
\begin{tabularx}{\textwidth}{|X|l|l|l|l|l|l|l|X|}
\hline
%-------------------------------------------------------------------
\textbf{Week 1} & \colcell \textbf{Mon} & \colcell \textbf{Tue} & \colcell \textbf{Wed} & \colcell \textbf{Thu} & \colcell \textbf{Fri} & \colcell \textbf{Sat} & \colcell \textbf{Sun}
\\ \hline 
%%------------------------------------------------------------------- 
%\rowcolor{Gray} 
\small \colcell 08:00-10:00 (11:00-16:00)& \colcelltwo & \small \colcellthree Exp & \colcelltwo & \small \colcellthree PL & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\small \colcell 10:00-13:00 & \small \colcellthree Exp & \colcelltwo & \colcelltwo & \small \colcellthree PL & \colcelltwo & & 
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\small \colcell 13:00-16:00 & \colcelltwo & \colcelltwo & \colcelltwo & \small \colcellthree PL & \colcelltwo & &
\\ \hline 
%%-------------------------------------------------------------------
%\rowcolor{Gray} 
\small \colcell 16:00-20:00 & & & \small \colcellthree Info& & & &
\\ \hline 
%%-------------------------------------------------------------------
\end{tabularx}
\end{table} 


\subsection{Scheduling objectives: stand-in maximization and schedule variation}

When we were first presented with the scheduling problem, it was explained to us that the main challenge for the library is to find a good number of stand-ins for all days. When we studied their schedule, we observed that only one stand-in was present at the worst day. Thus, the main objective of this thesis work is to create a feasible schedule, according to the constraints explained in this section, with as many stand-ins as possible at the day with the least number of stand-ins.

In this context, a stand-in is defined as a worker who is available for outer tasks during the first three shifts and who is not scheduled for any shift during that day. Both librarians and assistants can be stand-ins, but only librarians are qualified to be assigned to any task. Since the regular hour library activities are most crucial, there is no need for stand-ins during evenings and weekends. Similarly, there are no assigned stand-ins for the Library on Wheels or for Hageby.

Apart from maximizing the number of stand-ins for each day at the library, it is desirable for the sake of the personnel to create schedules that are repeated according to a five week pattern. Thus, the ten week schedule should ideally consist of two five week schedules.

\section{Aims and goals}

The goal of this thesis is to investigate how the ten week scheduling problem for the library staff members at the Central Library of Norrköping can be solved using mathematical optimi zation methods. This goal includes:

\begin{enumerate}
\item To investigate what has previously been done in the area of task distribution.
\item To find a mathematical model for the given problem.
\item To implement the model in AMPL.
\item To implement two heuristics for the problem using a large neighbourhood search framework, one using a week block scheduling approach and one using a task scheduling approach.
\item To evaluate and compare the models used in the three implementations as well as their performance.
\end{enumerate}


\section{Method}
The method used in the thesis work for solving the problem described above was to first formulate a mathematical model for the problem, which was then solved using two different methods. The first method involved modeling the problem in the AMPL programming language and solving it by the commercial optimization solver CPLEX. The second method involved creating an independent solver in C++ and solving it using a heuristic. Worker availability data was imported from Excel sheets to data files used to solve the problem through Visual Basic.

Two different heuristics were tested in the second approach. The first heuristic distributes week blocks to workers. All blocks are pre-generated and feasible according to the constraints described in the previous section. In the second heuristic, individual tasks are distributed to the workers. In order to move through the solution space and find better solutions, both heuristics were based on a Large Neighbourhood Search (LNS) algorithm.

\section{Outline}

The thesis is divided into six different chapters. The first chapter provides a description of the problem studied as well as the context of the study. In Chapter \ref{chap:lit}, previous work in the area is presented. The mathematical model constructed for solving the problem is presented and explained in Chapter \ref{chap:mathmod}. In Chapter \ref{chap:heur}, the different implementations of the model are presented and the results for these implementations are given in Chapter \ref{chap:res}. Lastly, conclusions from the work and suggestions for further development are presented in Chapter \ref{chap:concl}.

\section{Contributions of the authors}

The authors of this thesis have worked both individually and together. The mathematical model was constructed and implemented by both authors, while the two heuristics were constructed and implemented separately. The week block scheduling heuristic was implemented by Claes while the task distribution heuristic was implemented by Emelie.

In the report, Chapter \ref{chap:intro} was mainly written by Emelie. Chapter \ref{chap:lit} was divided so that Claes wrote \ref{PTSP} and \ref{SMTSP} Emelie wrote \ref{TSP} and \ref{MSC}. Other parts in the chapter were written together. The third chapter was written by Claes and in Chapter \ref{chap:heur} and \ref{chap:res}, the authors wrote the parts which concerned their own heuristic. Chapter \ref{chap:concl} was written by both authors.
 

