\section{Introduction}

The second heuristic approach tested distributes individual tasks to workers. This method greatly resembles the process of manually placing tasks as is typically done in many practical situations. The heuristic undergoes two phases. In the first phase, weekends, as well as some weekday tasks, are distributed and in the second phase the rest of the weekday tasks are distributed.

The primary method used in this approach is a large neighbourhood search (LNS) together with a simulated annhealing (SA) accept function. Destroying and repairing the solution, as is customary in LNS, helps leading the solution out of local optima or plateaus. Similarly, SA is used in order to allow the solution to move in a less favourable directions to avoid these local optima.

\section{Costs}
The search in this approach is guided using cost functions. In the original mathematical model, the cost of a schedule consists of two terms. The rest of the model consists of hard constraints which cannot be violated. However, in the heuristic approach these hard constraints are divided into hard and soft constraints, as is illustrated in Figure (TODO).

During the scheduling process in the implementation, three different objective functions are used. The objective functions are illustrated in Table (TODO) and consist of a weekend objective function, a worker objective function and a weekday objective function.

\begin{table}[!h]
\centering
\caption{Library objective functions}
\label{tab: task objective functions_test}
\begin{tabular}{|l|l|}
\hline
\multicolumn{2}{|l|}{Weekend Objective Function} \\
\hline 
%\multicolumn{2}{*}{Weekend Objective Function} \\
%\hline
%\multicolumn{2}{*}{Weekend Objective Function} \\
%\hline
\end{tabular}
\end{table}

\begin{table}[!h]
\centering
\caption{Library objective functions.}
\label{tab: task objective functions}
\begin{tabular}{|l|l|}
\hline
\begin{tabular}[t]{@{}c@{}} \textbf{Objective}\\ \textbf{Function} \\ \textbf{Type}\end{tabular} & \textbf{Cost components} \\
\hline
\multirow{5}{*}{\begin{tabular}[t]{@{}l@{}}\textbf{Weekend} \\ \textbf{Objective} \\ \textbf{Function}\end{tabular}} & \\
 & Min stand in cost + average num stand ins\\ 
 & Min shift availability cost + average shift avail\\
 & Min day availability cost + average day avail\\ 
 & \\
\hline
\multirow{7}{*}{\begin{tabular}[t]{@{}l@{}}\textbf{Worker}\\ \textbf{Objective}\\ \textbf{Function}\end{tabular}}    & \\
& Num tasks per day cost \\
& Num tasks per week cost \\
& Num PL per week cost \\
& Total num of PL cost \\
& Num tasks at same shift per week  cost \\
& \\
\hline

\multirow{4}{*}{\begin{tabular}[t]{@{}l@{}}\textbf{Weekday}\\ \textbf{Objective}\\ \textbf{Function}\end{tabular}}   & \\ & Min stand in cost   \\
 & \\ & \\
\hline
\end{tabular}
\end{table}


\begin{table}[!h]
\centering
\caption{Worker objective functions.}
\label{tab:worker objective functions}
\begin{tabular}{|p{3cm}|l|}
\hline
\begin{tabular}[t]{@{}c@{}} \textbf{Objective}\\ \textbf{Function} \\ \textbf{Type}\end{tabular} & \textbf{Cost components} \\
\hline
\multirow{7}{*}{\begin{tabular}[t]{@{}l@{}}\textbf{Worker}\\ \textbf{Objective}\\ \textbf{Function}\end{tabular}}    & \\
& Num tasks per day cost \\
& Num tasks per week cost \\
& Num PL per week cost \\
& Total num of PL cost \\
& Num tasks at same shift per week  cost \\
& \\

\hline
\end{tabular}
\end{table}

The weekday objective function is associated with the weekend distribution phase of the problem. In the weekend objective function, a stand in cost is defined as the weighted sum between the number of librarians and assistants which are stand ins at a certain day. The minimum stand in cost is defined as the cost at the worst av all days throughout all weeks.

The min shift availability cost refers to the minimum number of workers available at a shift throughout all shifts, days and weeks. Similarly, the min day availability cost is the lowest number of workers available any shift throughout the whole schedule. In addition to these costs, the average of all three cost types is also used to distinguish solutions which have the same cost.

The worker objective function is used during the weekday task distribution phase of the problem. The function value is a combination of the relaxed constraints of the problem, as described at the beginning of this chapter. Thus, the worker objective function must always be reduced to zero before the schedule will be considered feasible.

The objective function consists of five different costs. All of them are calculated as the total cost for all workers. For example, the first cost described in Table (todo) is the total number of tasks per day exceeding the maximum of one daily task. In the objective function, the sum of excess tasks is taken over all workers.

The second cost is the number of tasks exceeding four per week. The third is the number of Fetch list tasks performed by a worker exceeding the max limit of one per week. In addition to this, there is a specified max limit for the number of fetch lists that can be performed by a worker throughout all weeks and which is different for different workers. This is the fourth cost. Finally, the number of tasks performed at the same shift in a week should not exceed two, which is the final cost in the worker objective function.

A feasible solution, where the worker objective function is zero, is evaluated using the weekday objective function described lastly in the table. The objective function has only one cost and corresponds to the objective function in the mathematical model. The min stand in cost is calculated in the same way as in the weekend objective function.

\section{Weekend phase}

The first phase in the scheduling process is the weekend phase. In this phase the weekends of all workers are placed and optimized before placing the remaining tasks. The reason for implementing such a phase rather than placing all tasks at once was the big impact of the weekend structure on the entire schedule. First and foremost, the location of a worker's weekend affects the availability of the worker in the following week where the week rest is placed. The worker is unavailable during week rest and if such week rests are combined in an unfortunate way, the scheduling can result in an uneven distribution of workers during days affected by week rest.

In order to measure what a good distribution of weekends is, the weekend objective function described in the previous section is used during the search process. Although the overall objective is to maximize the number of stand ins at the most critical day in the schedule, that is, even out the stand ins over the days, it is not trivial to measure this in a schedule with no tasks placed. Evening work reduces potential stand ins as well as tasks distributed during the days. Furthermore, limits on how many tasks per week a person is allowed to take further complicates the measurement of stand ins.

Because of the difficulty in measuring stand ins, certain weekday tasks are placed already in the weekend phase. This includes all Library on Wheel tasks and all evening tasks. For the Library on Wheels, there is not much choice or variability, and thus a fixed schedule is applied for the workers. Similarly, the workers who are available at the evening tasks are in most part, equal to the number of workers needed, thus leaving little choice in scheduling evenings. This is illustrated in tables \ref{tab:num_avail_no_tasks} and \ref{tab:num_avail_with_tasks} which show the number of available workers before and after placing the task mentioned.

\begin{table}[!h]
\caption{Worker availability placing only weekends.}
\centering
\label{tab:num_avail_no_tasks}
\begin{tabular}{|C{1.2cm}
|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|}
\hline & \multicolumn{7}{l|}{\textbf{Num available assistants}} \\ \hline\rowcolor{Gray} & Mo & Tu & We & Th & Fr & Sa & Su \\ \hline\colcell Shift 1: & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!60}}10 & {\cellcolor{maroon!60}}10 & {\cellcolor{maroon!60}}10 & {\cellcolor{maroon!40}}6 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!40}}6 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!45}}7 & {\cellcolor{maroon!35}}5 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!25}}3 & {\cellcolor{maroon!20}}2 & {\cellcolor{maroon!20}}2 & {\cellcolor{maroon!25}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\hline & \multicolumn{7}{l|}{\textbf{Num available librarians}} \\ \hline\rowcolor{Gray} & Mo & Tu & We & Th & Fr & Sa & Su \\ \hline\colcell Shift 1: & {\cellcolor{maroon!90}}16 & {\cellcolor{maroon!85}}15 & {\cellcolor{maroon!90}}16 & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!70}}12 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!90}}18 & {\cellcolor{maroon!85}}15 & {\cellcolor{maroon!95}}17 & {\cellcolor{maroon!80}}14 & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!95}}17 & {\cellcolor{maroon!80}}14 & {\cellcolor{maroon!90}}18 & {\cellcolor{maroon!90}}18 & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!25}}3 & {\cellcolor{maroon!30}}4 & {\cellcolor{maroon!30}}4 & {\cellcolor{maroon!25}}3 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\hline & \multicolumn{7}{l|}{\textbf{Num available BB-librarians}} \\ \hline\rowcolor{Gray} & Mo & Tu & We & Th & Fr & Sa & Su \\ \hline\colcell Shift 1: & {\cellcolor{maroon!20}}2 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!20}}2 & {\cellcolor{maroon!20}}2 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\end{tabular}
\end{table}

\begin{table}[!h]
\centering
\caption{Worker availability after placing weekends as well as evening tasks and BokB for the same week.}
\label{tab:num_avail_with_tasks}
\begin{tabular}{|C{1.2cm}
|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|C{0.6cm}|}
\hline & \multicolumn{7}{l|}{\textbf{Num available assistants}} \\ \hline\rowcolor{Gray} & Mo & Tu & We & Th & Fr & Sa & Su \\ \hline\colcell Shift 1: & {\cellcolor{maroon!45}}7 & {\cellcolor{maroon!60}}10 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!45}}7 & {\cellcolor{maroon!55}}9 & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!45}}7 & {\cellcolor{maroon!45}}7 & {\cellcolor{maroon!50}}8 & {\cellcolor{maroon!40}}6 & {\cellcolor{maroon!40}}6 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\hline & \multicolumn{7}{l|}{\textbf{Num available librarians}} \\ \hline\rowcolor{Gray} & Mo & Tu & We & Th & Fr & Sa & Su \\ \hline\colcell Shift 1: & {\cellcolor{maroon!80}}14 & {\cellcolor{maroon!65}}11 & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!65}}11 & {\cellcolor{maroon!70}}12 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!80}}14 & {\cellcolor{maroon!65}}11 & {\cellcolor{maroon!80}}14 & {\cellcolor{maroon!65}}11 & {\cellcolor{maroon!70}}12 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!65}}11 & {\cellcolor{maroon!80}}14 & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!75}}13 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\hline & \multicolumn{7}{l|}{\textbf{Num available BB-librarians}} \\ \hline\rowcolor{Gray} & Mo & Tu & We & Th & Fr & Sa & Su \\ \hline\colcell Shift 1: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!15}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\end{tabular}
\end{table}


% Define block styles
\tikzstyle{decision} = [diamond, draw, fill=red!30,
    text width=3.5em, text badly centered, node distance=3cm, inner sep=0.1pt]
\tikzstyle{block} = [rectangle, draw, fill=blue!30,
    text width=5em, text centered, rounded corners, minimum height=4em]
\tikzstyle{line} = [draw, -latex']
\tikzstyle{cloud} = [draw, ellipse,fill=red!20, node distance=3cm,
    minimum height=2em]

\begin{figure}[!H]
\centering
\caption{Algorithm for distributing weekends.}
\label{fig:weekend_alg}
\scalebox{0.8}{
\begin{tikzpicture}[node distance = 2cm, auto]
    % Place nodes
    %Right row
    \node [scale=0.01,node distance=0cm] (invinit) {};
    \node [block, below of=invinit] (distribute) {Distribute all weekends randomly};
    \node [decision, below of=distribute, node distance=2.5cm] (evaluate) {Solution feasible?};
    \node [block, left of=distribute, node distance=4cm] (redistribute) {Remove all weekends};
     \node [block, below of=evaluate, node distance=3.5cm] (setobjf) {Set weekend obj fun value};
     \node [block, below of=setobjf, node distance=3cm] (save) {Save temp solution};
     \node [block, below of=save, node distance=3cm] (dr) {Destroy and repair solution};
     \node [decision, below of=dr] (evaluate2) {Solution feasible?};
     \node [block, right of=dr, node distance=3cm] (reload) {Reload temp solution};
     
     %Middle row
     \node [block, left of=evaluate2, node distance=5cm] (setobjf2) {Set weekend obj fun value};
     \node [decision, above of=setobjf2, node distance=2.5cm] (compare) {Better than saved?};
     \node [decision, above of=compare, node distance=2.5cm] (SA) {Accept anyway?};
     \node [decision, left of=SA, node distance=4cm] (best) {Best solution?};
     \node  [block, above of=SA, node distance =2.5cm] (reloadsaved) {Reload saved solution}; 
     \node [block, above of=best, minimum height=3em, node distance = 2cm] (savebest) {Save solution as best};
     \node [decision, above of=reloadsaved, node distance=2cm] (done) {Iteration \textgreater max?};
     \node[above of=savebest, left of=savebest, node distance=2.5cm, scale=0.1](inv){};
     
     %Bottom nodes
     \node [decision, below of=best, node distance=10cm] (isbest) {Current better than best?};
     \node [block, right of=isbest, minimum height=3em, node distance=3cm] (reload2) {Reload best};
      \node [block, below of=reload2, minimum height=3em, node distance=2.5cm] (finished) {Search finished!};

    % Draw edges
    \path [line] (invinit) -- (distribute);
    \path [line] (distribute) -- (evaluate);
    \path [line] (evaluate) -| node {no} (redistribute);
    \path [line] (redistribute) |- (distribute);
    \path [line] (evaluate) -- node {yes}(setobjf);
    \path [line] (setobjf) -- (save);
    \path [line] (save) -- (dr);
    \path [line] (dr) -- (evaluate2);
    \path [line] (evaluate2) -| node {no} (reload);
    \path [line] (reload) -- (dr);
    \path [line] (evaluate2) -- node {yes} (setobjf2);
    \path [line] (setobjf2) -- (compare);
    \path [line] (compare) -| node {yes} (best);
    \path [line] (compare) -- node {no} (SA);
    \path [line] (SA) -- node {yes} (best);
    \path [line] (SA) -- node {no} (reloadsaved);
    \path [line] (reloadsaved) -- (done);
    \path [line] (best) -- node {yes} (savebest);
    \path [line] (best) -- node {no} (done);
    \path [line] (savebest) -- (done);
    \path [line] (done) -- node {no}(save);
    \path [-,draw] (done) -- node {yes}(inv);
    \path [line] (inv) |- (isbest);
    \path [line] (isbest) -- node {no} (reload2);
    \path [line] (isbest) -- node {yes} (finished);
    \path [line] (reload2) -- (finished);
   
    %Feasiblity loop
    \node at (-2,-19) [above=4mm, right=2mm] {\textsc{feasibility loop}};
    \draw [color=gray!70,thick](-2,-19) rectangle (5,-12);
    %Weekend loop
    \node at (-10.5,-19.5) [above=4mm, right=2mm] {\textsc{weekend distribution loop}};
    \draw [color=gray!70,thick](-10.5,-19.5) rectangle (5,-6);
    %SA componenet
    \node at (-7.5,-13.5) [above=4mm, right=2mm] {\textsc{SA}};
    \draw [color=gray!70,thick](-7.5,-13.5) rectangle (-3,-10.5);
    %\path [line] (decide) -| node [near start] {yes} (update);
    %\path [line] (update) |- (identify);
    %\path [line] (decide) -- node {no}(stop);
    %\path [line,dashed] (expert) -- (init);
    %\path [line,dashed] (system) -- (init);
    %\path [line,dashed] (system) |- (evaluate);
\end{tikzpicture}
}
\end{figure}


The algorithm for the distribution of weekends is illustrated in Figure \ref{fig:weekend_alg}. Two loops exist, an outer weekend distribution loop and an inner feasibility loop. The outer loop is performed a number of iterations and performs a search among neighbouring solutions provided by the inner loop through destroying and repairing a proportion of the solution. The decisions directing the search are coloured pink and can be described as: 

\textbf{Accept anyway?} : All feasible solutions are pass from the feasibility loop to the weekend loop. If the solution is better or equally good as the previous one, it is accepted. However, if it is not it can still be accepted with the probability P, as described in Equations \ref{eq0} to \ref{eq2}. The delta energy is the differens in objective function value between two solutions. $T$ is the temperature of the SA accept function, which has an initial value of $T_0$ and which cools down with the iteration count  $t$ at a rate $\alpha$ ($0 < \alpha < 1$).

\begin{equation}
\Delta E = Wend_0 - Wend_1
\label{eq1}
\end{equation}

\begin{equation}
T = T_0 \alpha^t
\label{eq2}
\end{equation}

\begin{equation}
P = exp(-\Delta E /kT)
\label{eq0}
\end{equation}

\textbf{Solution feasible?} : The feasibility check in the algorithm corresponds to checking whether the number of workers available at each shift equals to the demand at each shift. A worker is counted as available if the worker is qualified and available for the task and has no other tasks scheduled during that day.

The infeasibility loop checks the necessary condition of having enough workers, but is not sufficient in order to prove that the final schedule is feasible. If other constraints cannot be fulfilled in the final assignment of tasks, the schedule would be infeasible.

\textbf{Better than saved?} :

\textbf{Best solution?} :

\textbf{Iteration $>$ max?} :

\textbf{Current better than best?} :

Destroying and repairing tasks in the  feasibility loop accounts for the LNS part of the problem. Destroying is always random, while the redistribution of weekends is done with priority on worker qualification, meaning that tasks with librarian qualification are placed first. Also, HB preferences are taken into account in the repair function.

\section{Weekday phase}

When entering the weekday phase, all weekends, evenings and BokB tasks are already placed. In this phase, the rest of the tasks, referred to as "weekday" tasks are also placed. The demand is illustrated in tabl \ref{tab:current_demand}. All week demand now looks the same for all weeks.


\begin{table}[!h]
\centering
\caption{Worker demand during a week when entering weekday phase.}
\label{tab:current_demand}
\begin{tabular}{|C{1.2cm}
|C{1cm}|C{1cm}|C{1cm}|C{1cm}|C{1cm}|}
\hline
\rowcolor{Gray} & Exp & Info & PL & HB & BokB \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Monday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!25}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Tuesday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!25}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Wednesday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!25}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Thursday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!25}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Friday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!50}}2 & {\cellcolor{maroon!25}}1 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 2: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 3: & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!75}}3 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\colcell Shift 4: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Saturday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
\multicolumn{6}{|l|}{\colcelltwo Sunday } \\ \hline
\colcell Shift 1: & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 & {\cellcolor{maroon!0}}0 \\ \hline
 \end{tabular}
\end{table}


The weekday distribution phase is similar to the weekend distribution phase, since it is divided into two loops. 


\begin{figure}[!h]
\centering
\caption{Algorithm for distributing weekday tasks.}
\label{fig:weekday_alg}
\begin{tikzpicture}[node distance = 2cm , auto, every node/.style={scale=0.8}]
    %Right column
    \node [scale=0.01,node distance=0cm] (invinit) {};
    \node [block, below of=invinit] (distribute) {Try distribute all tasks};
    \node [block, below of=distribute] (workercost) {Set worker obj fun};
    \node [decision, below of=workercost, node distance=2.5cm] (evaluatewc) {Worker cost = 0?};
    \node [decision, below of=evaluatewc, node distance=3cm] (evaluatetasks) {All tasks distributed?};
    \node [decision, below of=evaluatetasks, node distance=3cm] (feasible) {Solution feasible?};
    \node [block, below of=feasible, node distance=2.5cm] (destamount) {Set destroy amount};
    \node [block, below of=destamount] (dr) {Destroy and repair solution};

    %Middle column
     \node [block, left of=evaluatetasks, node distance = 4cm] (taskcost) {Set weekday costs};
    \node [decision, above of=taskcost, node distance=2cm] (best) {Best solution?};
    \node [block, above of=best, minimum height=3em, node distance = 2cm] (savebest) {Save solution as best};
    
    %Left column
    \node [decision, left of=savebest, node distance=4cm] (done) {Iteration \textgreater max?};
    \node [block, above of=done, node distance=3.5cm] (remove) {Remove all tasks};
    
    %Get solution
    \node [decision, below of=done, node distance=15cm] (isbest) {Current better than best?};
    \node [block, right of=isbest, minimum height=3em, node distance=3cm] (reload2) {Reload best};
    \node [block, below of=reload2, minimum height=3em, node distance=2.5cm] (finished) {Search finished!};
    
	%Invisible nodes
    \node [right of=evaluatewc, scale=0.1,node distance=2cm] (inv) {};
    \node [right of=dr, scale=0.1,node distance=4cm] (inv2) {};
    \node [right of=workercost, scale=0.1,node distance=4cm] (inv3) {};
    \node[left of=isbest, node distance=4cm, scale=0.1](inv4){};
    
 
	%Draw edges
	\path [line] (invinit) -- (distribute);
    \path [line] (distribute) -- (workercost);
    \path [line] (workercost) -- (evaluatewc);
    \path [line] (evaluatewc) -- node [anchor=east]{yes} (evaluatetasks);    
    \path [-,draw] (evaluatewc) -- node [anchor=south]{no} (inv);    
    \path [line] (evaluatetasks) -- node [anchor=south]{yes} (taskcost);
    \path [line] (evaluatetasks) -- node [anchor=east]{no} (feasible);
    \path [line] (destamount) -- (dr);
    \path [-,draw] (dr) -- (inv2);
    \path [-,draw] (inv2) -- (inv3);
    \path [line] (inv3) -- (workercost);
     %To middle row   
	\path [line] (inv) |- (feasible);
    \path [line] (feasible) -- node [anchor=east]{yes} (destamount);
    \path [line] (feasible) -| node [anchor=east]{no} (done);
    %Middle row
    \path [line] (done) -- node [anchor=east]{no}(remove);    
    \path [line] (best) -- node [anchor=east]{yes}(savebest);
    \path [line] (savebest) -- (done);
    \path [line] (best) -- node [anchor=east]{no}(done);
    \path [line] (taskcost) -- (best);
    \path [line] (remove) -- (distribute);
    \path [-,draw] (done) -| node [anchor=east] {yes} (inv4);
    \path [line] (inv4) -- (isbest);
    \path [line] (isbest) -- node [anchor=south]{no} (reload2);
    \path [line] (isbest) -- node [anchor=east]{yes} (finished);
    \path [line] (reload2) -- (finished);

    %Feasiblity loop
    \node at (-2,-15) [above=4mm, right=2mm] {\textsc{feasibility loop}};
    \draw [color=gray!70,thick](-2,-15) rectangle (4,-2.5);
    %Weekend loop
    \node at (-8,-15) [above=4mm, right=2mm] {\textsc{weeday task distribution loop}};
    \draw [color=gray!70,thick](-8,-15) rectangle (4,-0.5);
 
%    Feasiblity loop
%    \node at (-2,-21.5) [above=4mm, right=2mm] {\textsc{feasibility loop}};
%    \draw [color=gray!70,thick](-2,-21.5) rectangle (5,-10.5);
%    Weekend loop
%    \node at (-10.5,-22) [above=4mm, right=2mm] {\textsc{weekend distribution loop}};
%    \draw [color=gray!70,thick](-10.5,-22) rectangle (5,-9);
%    \path [line] (decide) -| node [near start] {yes} (update);
%    \path [line] (update) |- (identify);
%    \path [line] (decide) -- node {no}(stop);
%    \path [line,dashed] (expert) -- (init);
%    \path [line,dashed] (system) -- (init);
%    \path [line,dashed] (system) |- (evaluate);
\end{tikzpicture}
\end{figure}

Evenings,weekends and BokB already placed.

Concept: destroy worst worker until all workers have feasible schedules. Record the library cost of the solution.

Destroy: weekday tasks for workers with highest cost.
Repair: 1. qualification, 2. avail demand diff. Place cheapest worker.

Infeasibility: when a feasible worker cost is not found for a large number of iterations.

\section{Simplifications of Mathematical Model}
-10 Week scheduling
-Objective function term about similar weeks
-BokB fixed weeks for every other week workers.
-Even odd weeks. How to handle?
(-lower limit PL)

\section{Implementation}
C++, object orientation, run on a linux operating system. Reading availability of workers into the program and outputing a result file, which can be read by Excel. Results are to be visualized in Excel (write this in another part?)